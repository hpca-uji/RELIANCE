# RELIANCE

The RELIANCE project—*Radiología intELIgente en procesos AsisteNCiales urgEntes*—(Intelligent radiology in urgent care processes) aims to streamline the triage process in radiological emergency systems through the application of deep neural networks.

![32-category pathology system](images/hierarchy.png)

# About the project

This project focuses on the design and development of DNN for classifying chest X-rays into a 32-category pathology system specifically tailored for radiologists at the General University Hospital of Castellón, Spain. The system leverages deep learning models, including convolutional neural networks and vision transformers, intended for integration into medical device software to improve triage processes. A two-phase hyperparameter search found that the top-performing convolutional model achieved an AUC of 0.911, closely matching the 0.914 of the optimal vision transformer, highlighting the suitability of convolutional models for resource-constrained environments. The study also revealed inconsistencies in methodologies for effective augmentation and generalization, as training experiments showed minimal performance variation across different augmentation levels. A paper regarding this project in currently accepted and being edited for [BIOIMAGING 2026](https://bioimaging.scitevents.org/) conference

# Requirements

This repository is based on Python 3.11.10 and PyTorch 2.4. The full environment used in the project can be installed through the following steps:

1. `pip install -r requirements.txt`
2. `cd visionets/visionapi`
3. `pip install -e .`

The last step will install (in editable mode) the `visionapi` library specifically developed for this project. This library is responsible for model creation, data loading, optimizer setup, and includes several implemented loss functions.

# Project Structure

The repository is organized into three main components:

- **`computeauc`**: Scripts to compute AUC and confidence intervals (CI), along with the AUC CI results reported in the paper.
- **`dbprocess`**: Scripts for processing datasets, including the private Actualtec dataset, ChestX-ray14, and PadChest. This module also includes utilities to generate training, validation, and test splits.
- **`visionets`**: Scripts for model training, inference, and export. These scripts rely on a custom-developed package, `visionapi`, and also support hyperparameter search over a predefined space.

## `dbprocess`

One of the most important directories is `common/trainlabel`, which contains multiple processed versions of dataset labels:

- **`chestx14label`**: Training, validation, and test splits for the ChestX-ray14 dataset using the original 14-label schema.
- **`chestxlabel`**: Training, validation, and test splits for the ChestX-ray14 dataset using our 32-category pathology system.
- **`padchestlabel`**: Training, validation, and test splits for the PadChest dataset using our 32-category pathology system.
- **`urgencylabel`**: Training, validation, and test splits for the combined PadChest + ChestX-ray14 dataset using our 32-category pathology system.

These label folders are directly consumed by the training scripts.  
To preprocess images into the required format, run the `createimg.py` script located in `common/scripts`.

## `computeauc`

This directory contains precomputed AUC confidence interval results:

- **`cx14auc.json`**: AUC CI results for the `swintv2` model trained on the ChestX-ray14 dataset using the 14-label schema.
- **`padcx14auc.json`**: AUC CI results for the `teacher densenet169`, `convnext`, `deit`, and `swintv2` models trained on the combined PadChest + ChestX-ray14 dataset using the 32-category pathology system.

## `visionets`

This module contains scripts related to model training, evaluation, and experimentation:

- **`train.py`**: Main script for fine-tuning models with configurable hyperparameters in a distributed training setup.
- **`activelearn.py`**: Script for studying model adaptation to new samples from a different domain. This script is not used in the BIOMAGING 2026 paper.
- **`search.py`**: Hyperparameter search orchestration script. It invokes `train.py` using `Popen`.
- **`inference`**: Scripts for running inference on single DICOM images, directories of images, and dataset partitions generated by `dbprocess`.
- **`utils`**: Utility scripts for model export and metric computation.

Example commands and configurations can be found in `scripts.sh`.